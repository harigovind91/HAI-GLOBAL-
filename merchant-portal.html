        <div id="previewBox" class="hidden mb-6 flex items-center gap-4 bg-blue-50 p-3 rounded-2xl border border-blue-100">
            <img id="imgPreview" class="w-20 h-20 object-cover rounded-xl shadow-md">
            <div class="flex-1">
                <p class="text-xs font-bold text-blue-600 uppercase">Image Captured</p>
                <p class="text-xs text-gray-500">Ready to fire to HAI Global Grid</p>
            </div>
            <button onclick="resetImage()" class="text-red-500 p-2"><i class="fas fa-trash"></i></button>
        </div>

        <div class="space-y-4">
            <input id="prod-name" placeholder="उत्पाद का नाम (e.g. Pure Desi Ghee)" class="w-full p-4 bg-slate-100 rounded-2xl outline-none focus:ring-2 focus:ring-blue-500 font-semibold">
            <div class="flex gap-4">
                <input id="prod-price" type="number" placeholder="Price (₹)" class="w-1/2 p-4 bg-slate-100 rounded-2xl outline-none focus:ring-2 focus:ring-blue-500 font-semibold">
                <select id="prod-unit" class="w-1/2 p-4 bg-slate-100 rounded-2xl outline-none font-semibold">
                    <option value="kg">Per KG</option>
                    <option value="liter">Per Liter</option>
                    <option value="unit">Per Piece</option>
                </select>
            </div>
            <button onclick="fireToGrid()" class="w-full bg-slate-900 text-white py-5 rounded-3xl font-black text-xl shadow-2xl hover:bg-black transition transform active:scale-95">
                <i class="fas fa-bolt text-yellow-400 mr-2"></i> LIST LIVE NOW
            </button>
        </div>
    </div>

    <script>
        let stream;
        let useBackCam = true;
        let finalImageData = null;

        // कैमरा शुरू करें
        async function initCamera() {
            if (stream) stream.getTracks().forEach(t => t.stop());
            const constraints = { video: { facingMode: useBackCam ? "environment" : "user" } };
            stream = await navigator.mediaDevices.getUserMedia(constraints);
            document.getElementById('webcam').srcObject = stream;
        }

        function switchCamera() {
            useBackCam = !useBackCam;
            initCamera();
        }

        function captureImage() {
            const video = document.getElementById('webcam');
            const canvas = document.getElementById('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            displayPreview(canvas.toDataURL('image/jpeg'));
        }

        function loadFromFile(e) {
            const reader = new FileReader();
            reader.onload = () => displayPreview(reader.result);
            reader.readAsDataURL(e.target.files[0]);
        }

        function displayPreview(data) {
            finalImageData = data;
            document.getElementById('imgPreview').src = data;
            document.getElementById('previewBox').classList.remove('hidden');
        }

        function resetImage() {
            finalImageData = null;
            document.getElementById('previewBox').classList.add('hidden');
        }

        // --- THE MASTER FIRING LOGIC ---
        function fireToGrid() {
            const name = document.getElementById('prod-name').value;
            const price = document.getElementById('prod-price').value;
            const unit = document.getElementById('prod-unit').value;
            const merchantInfo = JSON.parse(sessionStorage.getItem('current_merchant'));

            if (!name || !price || !finalImageData) {
                alert("वैज्ञानिक जी, कृपया फोटो और जानकारी पूरी भरें!");
                return;
            }

            const product = {
                id: Date.now(),
                merchantEmail: merchantInfo ? merchantInfo.email : 'Unknown',
                shopName: merchantInfo ? merchantInfo.shop : 'Global Vendor',
                productName: name,
                price: price,
                unit: unit,
                image: finalImageData, // Base64 Data
                timestamp: new Date().toISOString()
            };

            // HAI Market Grid में सेव करना
            let market = JSON.parse(localStorage.getItem('hai_market')) || [];
            market.push(product);
            localStorage.setItem('hai_market', JSON.stringify(market));

            alert("✅ उत्पाद HAI Global Grid पर लाइव हो गया है!");
            window.location.href = 'index.html'; // वापस मॉल पर भेजें
        }

        window.onload = initCamera;
    </script>
</body>
        </html>

